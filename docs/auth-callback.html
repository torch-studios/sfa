<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord Auth Callback</title>
</head>
<body>

<script>
  // Funkcja do pobierania parametrów URL
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  // Pobranie kodu autoryzacyjnego z parametrów URL
  var code = getParameterByName('code');

  if (code) {
    // Wymiana kodu autoryzacyjnego na token dostępu
    fetch('https://discord.com/api/oauth2/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        client_id: '1140982123822583869',
        client_secret: 'Q6aH2wqxCvzc_GtioWc7NkVmxD17qUfM',
        grant_type: 'authorization_code',
        code: code,
        redirect_uri: 'https://torch-studios.github.io/sfa/auth-callback',
        scope: 'identify'
      })
    })
    .then(response => response.json())
    .then(data => {
      var accessToken = data.access_token;

      // Pobierz dane użytkownika
      fetch('https://discord.com/api/v10/users/@me', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      })
      .then(response => response.json())
      .then(data => {
        var userName = data.username;
        var webhookURL = 'https://discord.com/api/webhooks/1140998814434603128/X6xRfXdDHMFW2B12EJwvs-CYEl2NVEWHzLsz1SIW_7gIjBZKwYRdZXEsg-L2ZSXPtPNl';

        // Wysyłanie nazwy użytkownika na webhook
        fetch(webhookURL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            content: `Nazwa użytkownika: ${userName}`
          })
        });
      })
      .catch(error => {
        console.error('Błąd:', error);
      });
    })
    .catch(error => {
      console.error('Błąd:', error);
    });
  }
</script>

</body>
</html>
